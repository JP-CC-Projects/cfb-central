package com.jpcc.CFBProject.domain;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.jpcc.CFBProject.domain.boxscore.BoxScore;
import jakarta.transaction.Transactional;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;

import jakarta.persistence.*;

import static org.assertj.core.api.Assertions.*;

@SpringBootTest
@ActiveProfiles("test")
public class BoxScoreJsonTest {

    @Autowired
    private EntityManager entityManager;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    @Transactional
    public void testJsonToDatabase() throws Exception {
        // Sample JSON string
        String json = "{\"gameInfo\":{\"homeTeam\":\"Duke\",\"homePoints\":28,\"homeWinProb\":\"0.6312020012434084\",\"awayTeam\":\"Clemson\",\"awayPoints\":7,\"awayWinProb\":\"0.3687979987565916\",\"homeWinner\":true,\"excitement\":\"7.0391063645\"},\"teams\":{\"ppa\":[{\"team\":\"Clemson\",\"plays\":81,\"overall\":{\"total\":0.1295,\"quarter1\":-0.034,\"quarter2\":0.19,\"quarter3\":0.39,\"quarter4\":-0.073},\"passing\":{\"total\":-0.061,\"quarter1\":-0.366,\"quarter2\":0.233,\"quarter3\":0.164,\"quarter4\":-0.22},\"rushing\":{\"total\":0.357,\"quarter1\":0.382,\"quarter2\":0.142,\"quarter3\":0.546,\"quarter4\":0.271}},{\"team\":\"Duke\",\"plays\":63,\"overall\":{\"total\":0.2457,\"quarter1\":0.235,\"quarter2\":0.154,\"quarter3\":0.441,\"quarter4\":0.228},\"passing\":{\"total\":0.16,\"quarter1\":0.558,\"quarter2\":-0.02,\"quarter3\":-0.147,\"quarter4\":0.351},\"rushing\":{\"total\":0.346,\"quarter1\":-0.227,\"quarter2\":1.023,\"quarter3\":1.146,\"quarter4\":0.202}}],\"cumulativePpa\":[{\"team\":\"Clemson\",\"plays\":81,\"overall\":{\"total\":10.5,\"quarter1\":-0.6,\"quarter2\":4,\"quarter3\":8.6,\"quarter4\":-1.5},\"passing\":{\"total\":-2.7,\"quarter1\":-3.7,\"quarter2\":2.6,\"quarter3\":1.5,\"quarter4\":-3.1},\"rushing\":{\"total\":13.2,\"quarter1\":3.1,\"quarter2\":1.4,\"quarter3\":7.1,\"quarter4\":1.6}},{\"team\":\"Duke\",\"plays\":63,\"overall\":{\"total\":15.5,\"quarter1\":4,\"quarter2\":2.8,\"quarter3\":4.8,\"quarter4\":3.9},\"passing\":{\"total\":5.4,\"quarter1\":5.6,\"quarter2\":-0.3,\"quarter3\":-0.9,\"quarter4\":1.1},\"rushing\":{\"total\":10,\"quarter1\":-1.6,\"quarter2\":3.1,\"quarter3\":5.7,\"quarter4\":2.8}}],\"successRates\":[{\"team\":\"Clemson\",\"overall\":{\"total\":0.519,\"quarter1\":0.333,\"quarter2\":0.524,\"quarter3\":0.727,\"quarter4\":0.45},\"standardDowns\":{\"total\":0.625,\"quarter1\":0.4,\"quarter2\":0.625,\"quarter3\":0.778,\"quarter4\":0.583},\"passingDowns\":{\"total\":0.28,\"quarter1\":0.25,\"quarter2\":0.2,\"quarter3\":0.5,\"quarter4\":0.25}},{\"team\":\"Duke\",\"overall\":{\"total\":0.413,\"quarter1\":0.353,\"quarter2\":0.444,\"quarter3\":0.455,\"quarter4\":0.412},\"standardDowns\":{\"total\":0.389,\"quarter1\":0.273,\"quarter2\":0.375,\"quarter3\":0.5,\"quarter4\":0.444},\"passingDowns\":{\"total\":0.444,\"quarter1\":0.5,\"quarter2\":0.5,\"quarter3\":0.333,\"quarter4\":0.375}}],\"explosiveness\":[{\"team\":\"Clemson\",\"overall\":{\"total\":0.87,\"quarter1\":1.04,\"quarter2\":0.97,\"quarter3\":0.69,\"quarter4\":0.93}},{\"team\":\"Duke\",\"overall\":{\"total\":1.43,\"quarter1\":1.42,\"quarter2\":1.31,\"quarter3\":1.5,\"quarter4\":1.53}}],\"rushing\":[{\"team\":\"Clemson\",\"powerSuccess\":\"1.000\",\"stuffRate\":\"0.135\",\"lineYards\":\"144\",\"lineYardsAverage\":\"3.9\",\"secondLevelYards\":\"55\",\"secondLevelYardsAverage\":\"1.5\",\"openFieldYards\":\"54\",\"openFieldYardsAverage\":\"1.5\"},{\"team\":\"Duke\",\"powerSuccess\":\"1.000\",\"stuffRate\":\"0.207\",\"lineYards\":\"95\",\"lineYardsAverage\":\"3.3\",\"secondLevelYards\":\"49\",\"secondLevelYardsAverage\":\"1.7\",\"openFieldYards\":\"78\",\"openFieldYardsAverage\":\"2.7\"}],\"havoc\":[{\"team\":\"Duke\",\"total\":\"0.148\",\"frontSeven\":\"0.025\",\"db\":\"0.123\"},{\"team\":\"Clemson\",\"total\":\"0.048\",\"frontSeven\":\"0.000\",\"db\":\"0.048\"}],\"scoringOpportunities\":[{\"team\":\"Clemson\",\"opportunities\":6,\"points\":7,\"pointsPerOpportunity\":1.17},{\"team\":\"Duke\",\"opportunities\":6,\"points\":20,\"pointsPerOpportunity\":3.33}],\"fieldPosition\":[{\"team\":\"Clemson\",\"averageStart\":\"70.6\",\"averageStartingPredictedPoints\":\"1.26\"},{\"team\":\"Duke\",\"averageStart\":\"67.2\",\"averageStartingPredictedPoints\":\"1.66\"}]},\"players\":{\"usage\":[{\"player\":\"Cade Klubnik\",\"team\":\"Clemson\",\"position\":\"QB\",\"total\":0.667,\"quarter1\":0.611,\"quarter2\":0.571,\"quarter3\":0.636,\"quarter4\":0.85,\"rushing\":0.27,\"passing\":1},{\"player\":\"Riley Leonard\",\"team\":\"Duke\",\"position\":\"QB\",\"total\":0.651,\"quarter1\":0.706,\"quarter2\":0.889,\"quarter3\":0.727,\"quarter4\":0.294,\"rushing\":0.276,\"passing\":0.971},{\"player\":\"Will Shipley\",\"team\":\"Clemson\",\"position\":\"RB\",\"total\":0.309,\"quarter1\":0.389,\"quarter2\":0.286,\"quarter3\":0.227,\"quarter4\":0.35,\"rushing\":0.459,\"passing\":0.182},{\"player\":\"Jordan Waters\",\"team\":\"Duke\",\"position\":\"RB\",\"total\":0.238,\"quarter1\":0.176,\"quarter2\":0.222,\"quarter3\":0.182,\"quarter4\":0.353,\"rushing\":0.379,\"passing\":0.118},{\"player\":\"Jalon Calhoun\",\"team\":\"Duke\",\"position\":\"WR\",\"total\":0.159,\"quarter1\":0.176,\"quarter2\":0.111,\"quarter3\":0.273,\"quarter4\":0.118,\"rushing\":0,\"passing\":0.294},{\"player\":\"Jaquez Moore\",\"team\":\"Duke\",\"position\":\"RB\",\"total\":0.159,\"quarter1\":0.176,\"quarter2\":0.111,\"quarter3\":0.091,\"quarter4\":0.235,\"rushing\":0.241,\"passing\":0.088},{\"player\":\"Antonio Williams\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.148,\"quarter1\":0.278,\"quarter2\":0.143,\"quarter3\":0.045,\"quarter4\":0.15,\"rushing\":0,\"passing\":0.273},{\"player\":\"Phil Mafah\",\"team\":\"Clemson\",\"position\":\"RB\",\"total\":0.148,\"quarter1\":0.111,\"quarter2\":0.238,\"quarter3\":0.182,\"quarter4\":0.05,\"rushing\":0.27,\"passing\":0.045},{\"player\":\"Jordan Moore\",\"team\":\"Duke\",\"position\":\"WR\",\"total\":0.079,\"quarter1\":0.176,\"quarter2\":0.056,\"quarter3\":0.091,\"quarter4\":0,\"rushing\":0,\"passing\":0.147},{\"player\":\"Sahmir Hagans\",\"team\":\"Duke\",\"position\":\"WR\",\"total\":0.079,\"quarter1\":0.118,\"quarter2\":0.111,\"quarter3\":0.091,\"quarter4\":0,\"rushing\":0,\"passing\":0.147},{\"player\":\"Beaux Collins\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.074,\"quarter1\":0,\"quarter2\":0.048,\"quarter3\":0.182,\"quarter4\":0.05,\"rushing\":0,\"passing\":0.136},{\"player\":\"Nicky Dalmolin\",\"team\":\"Duke\",\"position\":\"TE\",\"total\":0.063,\"quarter1\":0.059,\"quarter2\":0.111,\"quarter3\":0.091,\"quarter4\":0,\"rushing\":0,\"passing\":0.118},{\"player\":\"Cole Turner\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.062,\"quarter1\":0.111,\"quarter2\":0.048,\"quarter3\":0,\"quarter4\":0.1,\"rushing\":0,\"passing\":0.114},{\"player\":\"Tyler Brown\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.025,\"quarter1\":0,\"quarter2\":0.048,\"quarter3\":0.045,\"quarter4\":0,\"rushing\":0,\"passing\":0.045},{\"player\":\"Jake Briningstool\",\"team\":\"Clemson\",\"position\":\"TE\",\"total\":0.025,\"quarter1\":0.056,\"quarter2\":0.048,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.045},{\"player\":\"Adam Randall\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.025,\"quarter1\":0,\"quarter2\":0,\"quarter3\":0.045,\"quarter4\":0.05,\"rushing\":0,\"passing\":0.045},{\"player\":\"Jontavis Robertson\",\"team\":\"Duke\",\"position\":\"WR\",\"total\":0.016,\"quarter1\":0,\"quarter2\":0.056,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.029},{\"player\":\"Brannon Spector\",\"team\":\"Clemson\",\"position\":\"WR\",\"total\":0.012,\"quarter1\":0,\"quarter2\":0.048,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.023}],\"ppa\":[{\"player\":\"Cade Klubnik\",\"team\":\"Clemson\",\"position\":\"QB\",\"average\":{\"total\":-0.013,\"quarter1\":-0.172,\"quarter2\":0.256,\"quarter3\":0.186,\"quarter4\":-0.262,\"rushing\":0.202,\"passing\":-0.061},\"cumulative\":{\"total\":-0.7,\"quarter1\":-1.9,\"quarter2\":3.1,\"quarter3\":2.6,\"quarter4\":-4.5,\"rushing\":2,\"passing\":-2.7}},{\"player\":\"Riley Leonard\",\"team\":\"Duke\",\"position\":\"QB\",\"average\":{\"total\":0.351,\"quarter1\":0.484,\"quarter2\":0.174,\"quarter3\":0.602,\"quarter4\":0.197,\"rushing\":1.06,\"passing\":0.179},\"cumulative\":{\"total\":14.4,\"quarter1\":5.8,\"quarter2\":2.8,\"quarter3\":4.8,\"quarter4\":1,\"rushing\":8.5,\"passing\":5.9}},{\"player\":\"Will Shipley\",\"team\":\"Clemson\",\"position\":\"RB\",\"average\":{\"total\":0.402,\"quarter1\":0.191,\"quarter2\":0.754,\"quarter3\":0.72,\"quarter4\":0.084,\"rushing\":0.509,\"passing\":0.175},\"cumulative\":{\"total\":10,\"quarter1\":1.3,\"quarter2\":4.5,\"quarter3\":3.6,\"quarter4\":0.6,\"rushing\":8.6,\"passing\":1.4}},{\"player\":\"Jordan Waters\",\"team\":\"Duke\",\"position\":\"RB\",\"average\":{\"total\":0.35,\"quarter1\":-0.387,\"quarter2\":0.704,\"quarter3\":-0.114,\"quarter4\":0.637,\"rushing\":0.166,\"passing\":0.855},\"cumulative\":{\"total\":5.2,\"quarter1\":-1.2,\"quarter2\":2.8,\"quarter3\":-0.2,\"quarter4\":3.8,\"rushing\":1.8,\"passing\":3.4}},{\"player\":\"Jalon Calhoun\",\"team\":\"Duke\",\"position\":\"WR\",\"average\":{\"total\":0.243,\"quarter1\":0.347,\"quarter2\":0.792,\"quarter3\":-0.064,\"quarter4\":0,\"rushing\":0,\"passing\":0.243},\"cumulative\":{\"total\":2.4,\"quarter1\":1,\"quarter2\":1.6,\"quarter3\":-0.2,\"quarter4\":0,\"rushing\":0,\"passing\":2.4}},{\"player\":\"Jaquez Moore\",\"team\":\"Duke\",\"position\":\"RB\",\"average\":{\"total\":0.378,\"quarter1\":0.269,\"quarter2\":-0.476,\"quarter3\":0.259,\"quarter4\":0.918,\"rushing\":0.467,\"passing\":0.171},\"cumulative\":{\"total\":3.8,\"quarter1\":0.8,\"quarter2\":-1,\"quarter3\":0.3,\"quarter4\":3.7,\"rushing\":3.3,\"passing\":0.5}},{\"player\":\"Antonio Williams\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":0.074,\"quarter1\":-0.019,\"quarter2\":0.672,\"quarter3\":-0.279,\"quarter4\":-0.251,\"rushing\":0,\"passing\":0.074},\"cumulative\":{\"total\":0.9,\"quarter1\":-0.1,\"quarter2\":2,\"quarter3\":-0.3,\"quarter4\":-0.8,\"rushing\":0,\"passing\":0.9}},{\"player\":\"Phil Mafah\",\"team\":\"Clemson\",\"position\":\"RB\",\"average\":{\"total\":0.229,\"quarter1\":-0.708,\"quarter2\":-0.021,\"quarter3\":0.816,\"quarter4\":1.006,\"rushing\":0.253,\"passing\":0.111},\"cumulative\":{\"total\":2.7,\"quarter1\":-1.4,\"quarter2\":-0.1,\"quarter3\":3.3,\"quarter4\":1,\"rushing\":2.5,\"passing\":0.2}},{\"player\":\"Jordan Moore\",\"team\":\"Duke\",\"position\":\"WR\",\"average\":{\"total\":-0.271,\"quarter1\":-0.014,\"quarter2\":-1.265,\"quarter3\":-0.045,\"quarter4\":0,\"rushing\":0,\"passing\":-0.271},\"cumulative\":{\"total\":-1.4,\"quarter1\":0,\"quarter2\":-1.3,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":-1.4}},{\"player\":\"Sahmir Hagans\",\"team\":\"Duke\",\"position\":\"WR\",\"average\":{\"total\":0.099,\"quarter1\":0.121,\"quarter2\":0.3,\"quarter3\":-0.349,\"quarter4\":0,\"rushing\":0,\"passing\":0.099},\"cumulative\":{\"total\":0.5,\"quarter1\":0.2,\"quarter2\":0.6,\"quarter3\":-0.3,\"quarter4\":0,\"rushing\":0,\"passing\":0.5}},{\"player\":\"Beaux Collins\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":0.475,\"quarter1\":0,\"quarter2\":0.619,\"quarter3\":0.277,\"quarter4\":1.125,\"rushing\":0,\"passing\":0.475},\"cumulative\":{\"total\":2.9,\"quarter1\":0,\"quarter2\":0.6,\"quarter3\":1.1,\"quarter4\":1.1,\"rushing\":0,\"passing\":2.9}},{\"player\":\"Nicky Dalmolin\",\"team\":\"Duke\",\"position\":\"TE\",\"average\":{\"total\":0.197,\"quarter1\":2.878,\"quarter2\":-0.896,\"quarter3\":-0.3,\"quarter4\":0,\"rushing\":0,\"passing\":0.197},\"cumulative\":{\"total\":0.8,\"quarter1\":2.9,\"quarter2\":-1.8,\"quarter3\":-0.3,\"quarter4\":0,\"rushing\":0,\"passing\":0.8}},{\"player\":\"Cole Turner\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":-0.098,\"quarter1\":-0.94,\"quarter2\":-0.322,\"quarter3\":0,\"quarter4\":0.856,\"rushing\":0,\"passing\":-0.098},\"cumulative\":{\"total\":-0.5,\"quarter1\":-1.9,\"quarter2\":-0.3,\"quarter3\":0,\"quarter4\":1.7,\"rushing\":0,\"passing\":-0.5}},{\"player\":\"Tyler Brown\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":-0.297,\"quarter1\":0,\"quarter2\":-1.162,\"quarter3\":0.567,\"quarter4\":0,\"rushing\":0,\"passing\":-0.297},\"cumulative\":{\"total\":-0.6,\"quarter1\":0,\"quarter2\":-1.2,\"quarter3\":0.6,\"quarter4\":0,\"rushing\":0,\"passing\":-0.6}},{\"player\":\"Jake Briningstool\",\"team\":\"Clemson\",\"position\":\"TE\",\"average\":{\"total\":0.174,\"quarter1\":-0.322,\"quarter2\":0.67,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.174},\"cumulative\":{\"total\":0.3,\"quarter1\":-0.3,\"quarter2\":0.7,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.3}},{\"player\":\"Adam Randall\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":-0.477,\"quarter1\":0,\"quarter2\":0,\"quarter3\":0.088,\"quarter4\":-1.041,\"rushing\":0,\"passing\":-0.477},\"cumulative\":{\"total\":-1,\"quarter1\":0,\"quarter2\":0,\"quarter3\":0.1,\"quarter4\":-1,\"rushing\":0,\"passing\":-1}},{\"player\":\"Jontavis Robertson\",\"team\":\"Duke\",\"position\":\"WR\",\"average\":{\"total\":0.635,\"quarter1\":0,\"quarter2\":0.635,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.635},\"cumulative\":{\"total\":0.6,\"quarter1\":0,\"quarter2\":0.6,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":0.6}},{\"player\":\"Brannon Spector\",\"team\":\"Clemson\",\"position\":\"WR\",\"average\":{\"total\":-1.041,\"quarter1\":0,\"quarter2\":-1.041,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":-1.041},\"cumulative\":{\"total\":-1,\"quarter1\":0,\"quarter2\":-1,\"quarter3\":0,\"quarter4\":0,\"rushing\":0,\"passing\":-1}}]}}";


        // Deserialize JSON to BoxScore object
        BoxScore boxScore = objectMapper.readValue(json, BoxScore.class);

        // Persist BoxScore object
        entityManager.persist(boxScore);

        // Flush and clear the persistence context to force a SQL call
        entityManager.flush();
        entityManager.clear();

        // Optionally, retrieve the persisted object and assert its state
        BoxScore retrievedBoxScore = entityManager.find(BoxScore.class, boxScore.getId());
        assertThat(retrievedBoxScore).isNotNull();
        // More assertions based on your entity structure and the expected state
    }
}